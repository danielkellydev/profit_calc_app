<%= turbo_frame_tag 'sales_record_frame' do %>
  <div class="bg-white shadow-lg rounded-lg p-6 mb-8">
    <h2 class="text-3xl font-semibold mb-8 text-gray-800">Edit Sale</h2>
    
    <%= form_with model: @sale, url: sale_path(@sale), method: :patch, class: "space-y-6" do |form| %>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        <% @products.each do |product| %>
          <% sale_item = @sale.sale_items.find { |si| si.product_id == product.id } %>
          <div class="product-card bg-gray-50 rounded-lg p-4 shadow-sm">
            <h3 class="text-lg font-medium text-gray-700 mb-2"><%= product.name %></h3>
            <%= form.label "quantity[#{product.id}]", 'Quantity', class: 'block text-sm font-medium text-gray-600' %>
            <%= form.number_field "quantity[#{product.id}]", value: sale_item&.quantity || 0, min: 0, class: 'mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500' %>
          </div>
        <% end %>
      </div>

      <div>
        <%= form.label :sale_date, class: 'block text-sm font-medium text-gray-700' %>
        <%= form.date_field :sale_date, class: 'mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500' %>
      </div>

      <div>
        <%= form.label :sale_type_id, 'Sale Type', class: 'block text-sm font-medium text-gray-700' %>
        <%= form.select :sale_type_id, @sale_types.map { |st| [st.name, st.id] }, {}, class: 'mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500' %>
      </div>

      <div>
        <%= form.label :total_received, class: 'block text-sm font-medium text-gray-700' %>
        <%= form.number_field :total_received, step: 0.01, class: 'mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500' %>
      </div>

      <%= form.submit "Update Sale", class: 'mt-6 w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500' %>
    <% end %>

    <%= link_to 'Back to Sales', sales_data_dashboard_index_path, data: { turbo_frame: "content_frame" }, class: 'mt-4 inline-block text-blue-600 hover:text-blue-800' %>
  </div>
<% end %>