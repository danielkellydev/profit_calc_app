<div class="container mx-auto px-4 py-4 sm:py-8">
  <div class="max-w-lg mx-auto bg-white rounded-lg shadow-md p-4 sm:p-6">
    <h1 class="text-2xl font-bold text-gray-900 mb-6">New Expense</h1>

    <% if @expense_categories.empty? %>
      <div class="bg-yellow-50 border border-yellow-200 rounded-md p-4 mb-6">
        <p class="text-yellow-800">You need to create at least one expense category first.</p>
        <%= link_to "Create Category", new_expense_category_path, class: "mt-2 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-1 px-3 rounded text-sm inline-block" %>
      </div>
    <% else %>
      <%= form_with model: @expense, local: true, class: "space-y-4" do |form| %>
        <% if @expense.errors.any? %>
          <div class="bg-red-50 border border-red-200 rounded-md p-4">
            <h2 class="text-red-800 font-medium">Please fix the following errors:</h2>
            <ul class="mt-2 text-sm text-red-700">
              <% @expense.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div>
          <%= form.label :name, class: "block text-sm font-medium text-gray-700" %>
          <%= form.text_field :name, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500", placeholder: "e.g., Office Rent" %>
        </div>

        <div>
          <%= form.label :expense_category_id, "Category", class: "block text-sm font-medium text-gray-700" %>
          <%= form.select :expense_category_id, 
              options_from_collection_for_select(@expense_categories, :id, :name, @expense.expense_category_id),
              { prompt: "Select a category" },
              { class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" } %>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <%= form.label :amount, class: "block text-sm font-medium text-gray-700" %>
            <%= form.number_field :amount, step: 0.01, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500", placeholder: "0.00" %>
          </div>

          <div>
            <%= form.label :frequency, class: "block text-sm font-medium text-gray-700" %>
            <%= form.select :frequency, 
                options_for_select([
                  ['Weekly', 'weekly'],
                  ['Monthly', 'monthly'], 
                  ['Annually', 'annually']
                ], @expense.frequency),
                { prompt: "Select frequency" },
                { class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" } %>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <%= form.label :start_date, "Start Date (optional)", class: "block text-sm font-medium text-gray-700" %>
            <%= form.date_field :start_date, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
          </div>

          <div>
            <%= form.label :end_date, "End Date (optional)", class: "block text-sm font-medium text-gray-700" %>
            <%= form.date_field :end_date, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
          </div>
        </div>

        <div class="flex items-center">
          <%= form.check_box :active, class: "h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" %>
          <%= form.label :active, "Active", class: "ml-2 block text-sm text-gray-900" %>
        </div>

        <div class="flex justify-between">
          <%= link_to "Cancel", expenses_path, class: "bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded" %>
          <%= form.submit "Create Expense", class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>